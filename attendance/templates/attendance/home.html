{% extends 'attendance/base.html' %}
{% block title %}Home{% endblock %}
{% block header %}
<h1 class="heading">Online Attendance System For BS FGDC</h1>
<form method="get" action="{% url 'search_attendance' %}" class="search-form" id="searchForm">
    <input type="text" name="student_name" placeholder="Enter student name" class="input-field" required pattern="[A-Za-z\s]+" title="Please enter only letters for the student name">
    <input type="text" name="roll_no" placeholder="Enter roll number" class="input-field" required pattern="\d+" title="Please enter only numbers for the roll number">
    <select id="department" name="department" class="input-field">
        <option value="">Select a department</option>
        {% for department in departments %}
            <option value="{{ department.id }}">{{ department.name }}</option>
        {% endfor %}
    </select>
    <select id="class" name="class" class="input-field">
        <option value="">Select a class (optional)</option>
        {% for class in classes %}
            <option value="{{ class.id }}">{{ class.name }}</option>
        {% endfor %}
    </select>
    
    
    <div class="filter-options">
        <input type="radio" name="filter_type" value="date" id="date_filter" checked>
        <label for="date_filter">Date Range</label>
        <input type="radio" name="filter_type" value="month" id="month_filter">
        <label for="month_filter">Month</label>
    </div>
    <div id="date_filters" class="date-filters">
        <input type="date" name="start_date" class="input-field" placeholder="Start Date">
        <input type="date" name="end_date" class="input-field" placeholder="End Date">
    </div>
    <div id="month_filters" class="month-filters" style="display: none;">
        <select name="month" id="month" class="input-field">
            <option value="">Select a month</option>
            <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>
        </select>
    </div>
    <button type="submit" class="submit-button">Search</button>
</form>
<div class="auth-buttons">
    <a class="button" href="{% url 'signin' %}">Teacher Sign In</a>
    <a class="button" href="{% url 'signup' %}">Teacher Sign Up</a>
</div>


<style>
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #2C3E50;
        color: #C5C6C7;
        margin: 0;
        padding: 0;
    }

    .container {
        background-color: #212E3C;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        max-width: 604px;
        width: 100%;
        margin: 40px auto;
    }

    .heading {
        background-color: #4F6C8A;
        color: #C5C6C7;
        padding: 10px 20px;
        border-radius: 10px 10px 0 0;
        font-size: 25px;
        margin: -20px -20px 20px -20px;
    }

    .search-form {
        display: flex;
        flex-direction: column;
        align-items: center;
    }


    .date-filters {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }
    
    .date-filters .input-field {
        width: auto; 
        max-width: 200px; 
        flex: 1; 
    }
    

    .input-field {
        width: 100%;
        max-width: 600px;
        padding: 10px;
        margin: 10px 0;
        border: none;
        background-color: #2C3E50;
        color: #C5C6C7;
        border-radius: 5px;
        box-sizing: border-box;
    }

    .filter-options {
        display: flex;
        justify-content: center;
        margin: 10px;
        color: #C5C6C7;
        flex-wrap: wrap;
    }

    .date-filters, .month-filters {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .submit-button {
        padding: 10px 20px;
        background-color: #4F6C8A;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        width: 100%;
        max-width: 300px;
    }

    .auth-buttons {
        display: flex;
        justify-content: center;
        gap: 20px; 
        margin-top: 20px;
    }

    .button {
        display: inline-block;
        padding: 10px 20px;
        background-color: #4F6C8A;
        color: #C5C6C7;
        text-decoration: none;
        border-radius: 5px;
        text-align: center;
        transition: background-color 0.3s;
        flex: 1; 
        max-width: 200px; 
    }

    @media (max-width: 768px) {
        .container {
            padding: 15px;
            margin: 20px auto;
        }

        .heading {
            font-size: 22px;
            padding: 10px;
        }

        .input-field, .submit-button, .button {
            width: calc(100% - 20px);
            margin: 5px 0;
        }
    }

    @media (max-width: 480px) {
        .container {
            width: 90%;
        }

        .heading {
            font-size: 18px;
            padding: 8px 15px;
        }

        .input-field {
            font-size: 14px;
            padding: 8px;
        }

        .submit-button, .button {
            font-size: 14px;
            padding: 8px;
        }
    }
</style>


<script>
    document.getElementById('department').addEventListener('change', function () {
        const departmentId = this.value;
        const classDropdown = document.getElementById('class');
        classDropdown.innerHTML = '<option value="">Select a class</option>';  // Reset class dropdown
    
        if (departmentId) {
            fetch(`/?department_id=${departmentId}`, { 
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            
            .then(response => response.json())
            .then(data => {
                console.log(data);  // Log the entire response to check if classes are returned
                if (data.classes) {
                    const classDropdown = document.getElementById('class');
                    classDropdown.innerHTML = '<option value="">Select a class</option>';
                    data.classes.forEach(classItem => {
                        const option = document.createElement('option');
                        option.value = classItem.id;
                        option.textContent = classItem.name;
                        classDropdown.appendChild(option);
                    });
                    classDropdown.disabled = false;
                } else {
                    console.error('No classes returned');
                }
            })
            .catch(error => console.error('Error fetching classes:', error));
        } else {
            classDropdown.disabled = true;
        }
    });
    
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateFilter = document.getElementById('date_filter');
        const monthFilter = document.getElementById('month_filter');
        const dateFilters = document.getElementById('date_filters');
        const monthFilters = document.getElementById('month_filters');
        const monthInput = document.getElementById('month');

        dateFilter.addEventListener('change', function() {
            if (dateFilter.checked) {
                dateFilters.style.display = 'block';
                monthFilters.style.display = 'none';
            }
        });

        monthFilter.addEventListener('change', function() {
            if (monthFilter.checked) {
                dateFilters.style.display = 'none';
                monthFilters.style.display = 'block';
            }
        });

        
        const searchForm = document.getElementById('searchForm');
        searchForm.addEventListener('submit', function(event) {
            const studentName = searchForm.student_name.value;
            const rollNo = searchForm.roll_no.value;
            const month = monthInput.value;

            const nameRegex = /^[A-Za-z\s]+$/;
            const rollNoRegex = /^\d+$/;
            const monthRegex = /^[A-Za-z\s]+$/; 

            if (!nameRegex.test(studentName)) {
                alert("Please enter only letters for the student name.");
                event.preventDefault(); 
            }

            if (!rollNoRegex.test(rollNo)) {
                alert("Please enter only numbers for the roll number.");
                event.preventDefault();
            }

            if (monthFilter.checked && !monthRegex.test(month)) {
                alert("Please enter a valid month name (letters only).");
                event.preventDefault(); 
            }
        });
    });
</script>
{% endblock %}
